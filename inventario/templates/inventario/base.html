<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}Inventario{% endblock %}</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/normalize.css' %}">
    <link rel="stylesheet" href="{% static 'css/sweetalert2.css' %}">
    <link rel="stylesheet" href="{% static 'css/material.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/material-design-iconic-font.min.css' %}">
    <link rel="stylesheet" href="{% static 'css/jquery.mCustomScrollbar.css' %}">
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    {% block extra_css %}{% endblock %}
</head>
<body>

    <!-- navLateral -->
    <section class="full-width navLateral">
        <div class="full-width navLateral-bg btn-menu"></div>
        <div class="full-width navLateral-body">
            <div class="full-width navLateral-body-logo text-center tittles">
                <i class="zmdi zmdi-close btn-menu"></i> Inventario
            </div>
            <!-- User Profile Section -->
            <div class="full-width text-center user-profile">
                <figure>
                    <img src="{% static 'assets/img/avatar-male.png' %}" alt="Avatar" class="img-responsive">
                </figure>
                <figcaption class="text-center">
                    <span>{{ user.get_full_name|default:user.RutUsuua }}</span><br>
                    <small>{{ user.cargo|default:'Usuario' }}</small>
                </figcaption>
            </div>
            <nav class="full-width">
                <ul class="full-width list-unstyle menu-principal">
                    <li class="full-width">
                        <a href="{% url 'ventas:registrar_venta' %}" class="full-width">
                            <div class="navLateral-body-cl">
                                <i class="zmdi zmdi-shopping-cart"></i>
                            </div>
                            <div class="navLateral-body-cr">
                                Registrar Venta
                            </div>
                        </a>
                    </li>
                    <li class="full-width divider-menu-h"></li>
                    <li class="full-width">
                        <a href="{% url 'inventario:lista_productos' %}" class="full-width">
                            <div class="navLateral-body-cl">
                                <i class="zmdi zmdi-view-list"></i>
                            </div>
                            <div class="navLateral-body-cr">
                                Lista de Productos
                            </div>
                        </a>
                    </li>
                    <li class="full-width">
                        <a href="{% url 'inventario:registrar_producto' %}" class="full-width">
                            <div class="navLateral-body-cl">
                                <i class="zmdi zmdi-plus"></i>
                            </div>
                            <div class="navLateral-body-cr">
                                Registrar Producto
                            </div>
                        </a>
                    </li>
                    <li class="full-width">
                        <a href="{% url 'inventario:selectar_producto_para_cepillar' %}" class="full-width">
                            <div class="navLateral-body-cl">
                                <i class="zmdi zmdi-wrench"></i> 
                            </div>
                            <div class="navLateral-body-cr">
                                Registrar Cepillado
                            </div>
                        </a>
                    </li>
                    <li class="full-width">
                        <a href="{% url 'inventario:alerta_stock' %}" class="full-width">
                            <div class="navLateral-body-cl">
                                <i class="zmdi zmdi-alert-triangle"></i>
                            </div>
                            <div class="navLateral-body-cr">
                                Alertas de Stock
                            </div>
                        </a>
                    </li>
                    <li class="full-width">
                        <a href="{% url 'ventas:lista_ventas' %}" class="full-width">
                            <div class="navLateral-body-cl">
                                <i class="zmdi zmdi-assignment"></i>
                            </div>
                            <div class="navLateral-body-cr">
                                Lista de Ventas
                            </div>
                        </a>
                    </li>
                    <li class="full-width">
                        <a href="{% url 'inventario:editar-umbrales-de-stock' %}" class="full-width">
                            <div class="navLateral-body-cl">
                                <i class="zmdi zmdi-settings"></i>
                            </div>
                            <div class="navLateral-body-cr">
                                Editar Umbrales Stock
                            </div>
                        </a>
                    </li>
                    <li class="full-width">
                        <a href="{% url 'compras:registrar_compra' %}" class="full-width">
                            <div class="navLateral-body-cl">
                                <i class="zmdi zmdi-shopping-cart"></i>
                            </div>
                            <div class="navLateral-body-cr">
                                Registrar Compra
                            </div>
                        </a>
                    </li>
                    <li class="full-width">
                        <a href="{% url 'compras:lista_compras' %}" class="full-width">
                            <div class="navLateral-body-cl">
                                <i class="zmdi zmdi-assignment"></i>
                            </div>
                            <div class="navLateral-body-cr">
                                Lista de Compras
                            </div>
                        </a>
                    </li>
                    <li class="full-width">
                        <a href="{% url 'reportes:generar' %}" class="full-width">
                            <div class="navLateral-body-cl">
                                <i class="zmdi zmdi-file-text"></i>
                            </div>
                            <div class="navLateral-body-cr">
                                Generar Reportes
                            </div>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </section>

    <!-- pageContent -->
    <section class="full-width pageContent">
        <!-- navBar -->
        <div class="full-width navBar">
            <div class="full-width navBar-options">
                <i class="zmdi zmdi-swap btn-menu" id="btn-menu"></i>    
                <div class="mdl-tooltip" for="btn-menu">Hide / Show MENU</div>
                <nav class="navBar-options-list">
                    <ul class="list-unstyle">
                        <li class="btn-notification" style="margin-right: 15px;">
                            <a href="#" id="notificationButton">
                                <i class="zmdi zmdi-notifications"></i>
                                <div class="mdl-tooltip" for="btn-notification">Notificaciones</div>
                            </a>
                        </li>
                        <li class="btn-exit">
                            <a href="{% url 'usuario:logout' %}">
                                <i class="zmdi zmdi-power"></i>
                                <div class="mdl-tooltip" for="btn-exit">Cerrar Sesión</div>
                            </a>
                    </ul>
                </nav>
            </div>
        </div>

        <div class="full-width" style="padding: 20px;">
            {% block content %}
            <!-- Contenido dinámico de cada página -->
            {% endblock %}
        </div>
    </section>

    <!-- Scripts -->
    <script src="{% static 'js/jquery-1.11.2.min.js' %}"></script>
    <script src="{% static 'js/material.min.js' %}"></script>
    <script src="{% static 'js/sweetalert2.min.js' %}"></script>
    <script src="{% static 'js/jquery.mCustomScrollbar.concat.min.js' %}"></script>
    <script src="{% static 'js/main.js' %}"></script>
    {% if messages %}
    <script>
        console.log("Hay mensajes para mostrar");
        {% for message in messages %}
            console.log("Mensaje: {{ message }}");
            console.log("Tipo: {{ message.tags }}");
        {% endfor %}
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            {% for message in messages %}
                {% if message.tags == 'success' %}
                    Swal.fire({
                        title: '¡Éxito!',
                        text: "{{ message }}",
                        icon: 'success',
                        confirmButtonText: 'OK'
                    });
                {% elif message.tags == 'error' %}
                    Swal.fire({
                        title: '¡Error!',
                        text: "{{ message }}",
                        icon: 'error',
                        confirmButtonText: 'OK'
                    });
                {% endif %}
            {% endfor %}
        });
    </script>
    {% else %}
    <script>
        console.log("No hay mensajes para mostrar");
    </script>
    {% endif %}
    <script>
    document.getElementById('notificationButton').addEventListener('click', function(e) {
        e.preventDefault();
        fetch('/logger/get-logs/')
            .then(response => response.json())
            .then(data => {
                let logsList = data.logs.map(log => {
                    // Determinar colores según la app
                    let appColor, bgColor;
                    switch(log.app) {
                        case 'inventario':
                            if (log.message.includes('cepillado')) {
                                appColor = '#795548'; // Café
                                bgColor = '#D7CCC8'; // Café claro
                            } else {
                                appColor = '#4CAF50';
                                bgColor = '#DCEDC8';
                            }
                            break;
                        case 'ventas':
                            appColor = '#2196F3';
                            bgColor = '#BBDEFB';
                            break;
                        case 'compras':
                            appColor = '#FF9800';
                            bgColor = '#FFE0B2';
                            break;
                        case 'sistema':
                            appColor = '#757575';
                            bgColor = '#EEEEEE';
                            break;
                        default:
                            appColor = '#757575';
                            bgColor = '#F5F5F5';
                    }

                    return `<div class="log-item" style="padding: 12px; border-left: 4px solid ${appColor}; margin: 0 1px; background-color: ${bgColor};">
                        <div style="color: #666; font-size: 0.85em; margin-bottom: 5px;">
                            <span style="color: ${appColor}; font-weight: 500;">${log.app.toUpperCase()}</span> - ${log.timestamp}
                        </div>
                        <div style="color: #333; font-size: 1em;">${log.message}</div>
                    </div>`;
                }).join('');

                Swal.fire({
                    title: 'Actividad Reciente',
                    html: `<div style="max-height: 400px; overflow-y: auto;">
                        ${logsList}
                    </div>`,
                    width: '600px',
                    confirmButtonText: 'Cerrar',
                    confirmButtonColor: '#3F51B5',
                    customClass: {
                        container: 'custom-swal-container',
                        popup: 'custom-swal-popup',
                        content: 'custom-swal-content'
                    }
                });
            });
    });
    </script>

    <style>
        .custom-swal-popup {
            padding: 20px;
            border-radius: 8px;
        }

        .custom-swal-container {
            z-index: 9999;
        }

        .custom-swal-content {
            padding: 0;
        }

        .log-item {
            transition: background-color 0.2s;
            padding: 12px 24px;
            margin: 1px 0;
        }

        .log-item:hover {
            filter: brightness(0.98);
        }

        .swal2-title {
            color: #333;
            font-size: 1.5em;
            font-weight: 500;
            margin-bottom: 20px;
        }

        .swal2-confirm {
            background-color: #3F51B5 !important;
        }

        .swal2-html-container {
            margin: 0;
            padding: 10px 0;
        }
    </style>
    {% block extra_js %}{% endblock %}
</body>
</html>