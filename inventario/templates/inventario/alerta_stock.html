{% extends "inventario/base.html" %}
{% load static %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row">
        <div class="col-12">
            <h2 class="mb-4 text-primary">
                <i class="zmdi zmdi-alert-circle me-2"></i>Alertas de Stock
            </h2>
        </div>
    </div>

    <!-- Alertas de estado -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="mdl-card mdl-shadow--2dp full-width">
                <div class="mdl-card__supporting-text">
                    <div class="alert alert-info">
                        <i class="zmdi zmdi-calendar me-2"></i>
                        Estación actual: {{ estacion_actual }}
                    </div>
                    
                    {% if total_alertas > 0 %}
                        <div class="alert alert-warning">
                            <i class="zmdi zmdi-alert-triangle me-2"></i>
                            Tienes {{ total_alertas }} producto(s) con stock bajo o en pre-alerta
                        </div>
                    {% else %}
                        <div class="alert alert-success">
                            <i class="zmdi zmdi-check-circle me-2"></i>
                            Todos los productos tienen stock suficiente
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Divider -->
    <div class="full-width divider-menu-h"></div>

    <!-- Tabla de Productos -->
    <div class="mdl-grid">
        <div class="mdl-cell mdl-cell--12-col">
            <div class="table-responsive">
                <table class="mdl-data-table mdl-js-data-table mdl-shadow--2dp full-width">
                    <thead>
                        <tr>
                            <th class="mdl-data-table__cell--non-numeric">Producto</th>
                            <th class="mdl-data-table__cell--non-numeric">Categoría</th>
                            <th>Stock Actual</th>
                            <th>Umbral Actual</th>
                            <th>% del Umbral</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in productos_bajo_stock %}
                        <tr class="{{ item.css_class }}">
                            <td class="mdl-data-table__cell--non-numeric">{{ item.producto.nombre }}</td>
                            <td class="mdl-data-table__cell--non-numeric">{{ item.producto.categoria }}</td>
                            <td>{{ item.stock_actual }}</td>
                            <td>{{ item.umbral }}</td>
                            <td>{{ item.ratio }}%</td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="5" class="mdl-data-table__cell--non-numeric">No hay productos con stock bajo</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<style>
/* Gris: entre 75% y 105% del umbral */
.row-normal {
    background-color: #e0e0e0 !important;
}

/* Naranjo: entre 50% y 75% del umbral */
.row-warning {
    background-color: #fff3e0 !important;
}

/* Rojo: entre 25% y 50% del umbral */
.row-low {
    background-color: #ffcdd2 !important;
}

/* Rojo fuerte: ≤25% del umbral */
.row-critical {
    background-color: #ef9a9a !important;
    font-weight: bold;
}

.mdl-data-table {
    border: none !important;
    white-space: normal !important;
}

.mdl-data-table td {
    padding: 12px 18px !important;
}

/* ---------- ESTILO PARA EL ENCABEZADO (PRIMERA FILA) ---------- */
/* Igual a tu tabla de productos */
.mdl-data-table thead tr {
    background-color: #f2f2f2 !important;   /* Gris claro */
}

.mdl-data-table thead th {
    font-weight: bold !important;
    color: #000 !important;
    background-image: none !important;
    border-bottom: 2px solid #ddd !important;
    padding: 12px 18px !important;
}
/* -------------------------------------------------------------- */


.alert {
    padding: 15px;
    margin-bottom: 20px;
    border: 1px solid transparent;
    border-radius: 4px;
}
.alert-info {
    background-color: #e3f2fd;
    border-color: #bbdefb;
    color: #0d47a1;
}
.alert-warning {
    background-color: #fff3e0;
    border-color: #ffe0b2;
    color: #e65100;
}
.alert-success {
    background-color: #e8f5e9;
    border-color: #c8e6c9;
    color: #1b5e20;
}
</style>

{% endblock %}
